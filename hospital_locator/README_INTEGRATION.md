# Hospital Locator - T√≠ch h·ª£p th∆∞ vi·ªán GIS

## üèóÔ∏è Ki·∫øn tr√∫c t·ªïng quan

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      REACT FRONTEND (Port 3000)                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  React.js          ‚îÇ  Leaflet/React-Leaflet  ‚îÇ  Material-UI     ‚îÇ
‚îÇ  React Router      ‚îÇ  Axios                  ‚îÇ  Chart.js        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº HTTP/REST API
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    DJANGO BACKEND (Port 8000)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Django REST Framework  ‚îÇ  Django Filters  ‚îÇ  CORS              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                              ‚îÇ
                              ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      POSTGRESQL/POSTGIS                         ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Spatial Database  ‚îÇ  GeoDjango ORM  ‚îÇ  Spatial Queries         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì¶ Th∆∞ vi·ªán Frontend (React)

### C√†i ƒë·∫∑t
```bash
cd hospital_locator/frontend
npm install
```

### C√°c th∆∞ vi·ªán ch√≠nh

| Th∆∞ vi·ªán | Phi√™n b·∫£n | M·ª•c ƒë√≠ch |
|----------|-----------|----------|
| `react` | ^18.2.0 | Framework ch√≠nh |
| `react-dom` | ^18.2.0 | React DOM rendering |
| `react-router-dom` | ^6.20.0 | Client-side routing |
| `leaflet` | ^1.9.4 | Th∆∞ vi·ªán b·∫£n ƒë·ªì |
| `react-leaflet` | ^4.2.1 | React wrapper cho Leaflet |
| `@mui/material` | ^5.14.0 | UI components |
| `@mui/icons-material` | ^5.14.0 | Icons |
| `axios` | ^1.6.0 | HTTP client |
| `recharts` | ^2.9.0 | Charts/Statistics |
| `leaflet-geosearch` | ^3.11.0 | T√¨m ki·∫øm ƒë·ªãa ƒëi·ªÉm |

### C·∫•u tr√∫c Frontend
```
frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.jsx        # Navigation bar
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MapContainer.jsx  # B·∫£n ƒë·ªì GIS ch√≠nh
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ SearchFilters.jsx # T√¨m ki·∫øm & l·ªçc
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HospitalPopup.jsx # Popup th√¥ng tin b·ªánh vi·ªán
‚îÇ   ‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ MapPage.jsx       # Trang b·∫£n ƒë·ªì
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HospitalsPage.jsx # Danh s√°ch b·ªánh vi·ªán
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ HospitalDetailPage.jsx # Chi ti·∫øt b·ªánh vi·ªán
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js            # API service layer
‚îÇ   ‚îú‚îÄ‚îÄ App.jsx               # Main app component
‚îÇ   ‚îî‚îÄ‚îÄ index.js              # Entry point
```

## üì¶ Th∆∞ vi·ªán Backend (Django)

### C√†i ƒë·∫∑t
```bash
cd hospital_locator/backend
pip install -r requirements.txt
```

### C·∫•u tr√∫c Backend
```
backend/
‚îú‚îÄ‚îÄ hospitals/
‚îÇ   ‚îú‚îÄ‚îÄ models.py        # Hospital model v·ªõi PointField
‚îÇ   ‚îú‚îÄ‚îÄ views.py         # API viewsets (list, retrieve, nearby, stats)
‚îÇ   ‚îú‚îÄ‚îÄ serializers.py   # GeoFeatureModelSerializer
‚îÇ   ‚îú‚îÄ‚îÄ admin.py         # GISModelAdmin configuration
‚îÇ   ‚îú‚îÄ‚îÄ urls.py          # App URL patterns
‚îÇ   ‚îî‚îÄ‚îÄ apps.py          # App configuration
‚îú‚îÄ‚îÄ settings.py          # Django settings v·ªõi GIS config
‚îú‚îÄ‚îÄ urls.py              # Main URL routing
‚îú‚îÄ‚îÄ wsgi.py              # WSGI application
‚îî‚îÄ‚îÄ manage.py            # Django management
```

## üîó T√≠ch h·ª£p Frontend ‚Üî Backend

### 1. API Configuration (`frontend/src/services/api.js`)

```javascript
import axios from 'axios';

const api = axios.create({
  baseURL: process.env.REACT_APP_API_URL || 'http://127.0.0.1:8000/api',
  headers: {
    'Content-Type': 'application/json',
  },
});

export const hospitalAPI = {
  // L·∫•y t·∫•t c·∫£ b·ªánh vi·ªán (GeoJSON)
  getAllHospitals: () => api.get('/hospitals/'),
  
  // Chi ti·∫øt 1 b·ªánh vi·ªán
  getHospitalById: (id) => api.get(`/hospitals/${id}/`),
  
  // T√¨m ki·∫øm & l·ªçc
  searchHospitals: (params) => api.get('/hospitals/', { params }),
  
  // T√¨m b·ªánh vi·ªán g·∫ßn (GIS spatial query)
  getNearbyHospitals: (lat, lng, radius = 5) => 
    api.get(`/hospitals/nearby/?lat=${lat}&lng=${lng}&radius=${radius}`),
  
  // T√¨m b·ªánh vi·ªán g·∫ßn nh·∫•t
  getNearestHospital: (lat, lng) => 
    api.post('/hospitals/nearest/', { latitude: lat, longitude: lng }),
  
  // Th·ªëng k√™
  getHospitalStats: () => api.get('/hospitals/stats/'),
  
  // L·∫•y danh s√°ch qu·∫≠n/huy·ªán
  getDistricts: () => api.get('/hospitals/districts/'),
};
```

### 2. Map Integration (`frontend/src/components/MapContainer.jsx`)

```jsx
import { MapContainer, TileLayer, Marker, Popup } from 'react-leaflet';
import L from 'leaflet';
import 'leaflet/dist/leaflet.css';

// Custom icons cho t·ª´ng lo·∫°i b·ªánh vi·ªán
const hospitalIcons = {
  public: new L.Icon({
    iconUrl: '/icons/hospital-public.png',
    iconSize: [30, 30],
  }),
  private: new L.Icon({
    iconUrl: '/icons/hospital-private.png',
    iconSize: [30, 30],
  }),
  clinic: new L.Icon({
    iconUrl: '/icons/clinic.png',
    iconSize: [25, 25],
  }),
};

function MapContainer({ hospitals, userLocation }) {
  return (
    <MapContainer center={[10.762622, 106.660172]} zoom={12}>
      <TileLayer
        url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
        attribution='¬© OpenStreetMap contributors'
      />
      
      {/* User location marker */}
      {userLocation && (
        <Marker position={userLocation} icon={userIcon}>
          <Popup>V·ªã tr√≠ c·ªßa b·∫°n</Popup>
        </Marker>
      )}
      
      {/* Hospital markers */}
      {hospitals.map((hospital) => (
        <Marker
          key={hospital.id}
          position={[hospital.latitude, hospital.longitude]}
          icon={hospitalIcons[hospital.hospital_type]}
        >
          <Popup>
            <HospitalPopup hospital={hospital} />
          </Popup>
        </Marker>
      ))}
    </MapContainer>
  );
}
```

### 3. GIS Backend Views (`backend/hospitals/views.py`)

```python
from django.contrib.gis.db.models.functions import Distance
from django.contrib.gis.geos import Point
from rest_framework import viewsets, status
from rest_framework.decorators import action
from rest_framework.response import Response
from .models import Hospital
from .serializers import HospitalSerializer

class HospitalViewSet(viewsets.ModelViewSet):
    queryset = Hospital.objects.all()
    serializer_class = HospitalSerializer
    
    # Spatial query: T√¨m b·ªánh vi·ªán g·∫ßn
    @action(detail=False, methods=['get'])
    def nearby(self, request):
        lat = float(request.query_params.get('lat'))
        lng = float(request.query_params.get('lng'))
        radius_km = float(request.query_params.get('radius', 5))
        
        user_location = Point(lng, lat, srid=4326)
        radius_m = radius_km * 1000
        
        # Spatial filtering v·ªõi PostGIS
        hospitals = Hospital.objects.filter(
            location__distance_lte=(user_location, radius_m)
        ).annotate(
            distance=Distance('location', user_location)
        ).order_by('distance')
        
        serializer = self.get_serializer(hospitals, many=True)
        return Response(serializer.data)
    
    # Th·ªëng k√™
    @action(detail=False, methods=['get'])
    def stats(self, request):
        stats = {
            'total': Hospital.objects.count(),
            'by_type': {
                'public': Hospital.objects.filter(hospital_type='public').count(),
                'private': Hospital.objects.filter(hospital_type='private').count(),
                'clinic': Hospital.objects.filter(hospital_type='clinic').count(),
            },
            'by_district': list(
                Hospital.objects.values('district')
                .annotate(count=models.Count('id'))
                .order_by('-count')
            ),
        }
        return Response(stats)
```

## üó∫Ô∏è GIS Features

### 1. Spatial Data Model
```python
from django.contrib.gis.db import models

class Hospital(models.Model):
    name = models.CharField(max_length=255)
    hospital_type = models.CharField(choices=[('public', 'C√¥ng l·∫≠p'), ...])
    latitude = models.FloatField()
    longitude = models.FloatField()
    
    # GIS Point Field (WGS84)
    location = models.PointField(srid=4326, null=True, blank=True)
    
    def save(self, *args, **kwargs):
        if self.latitude and self.longitude:
            self.location = Point(self.longitude, self.latitude, srid=4326)
        super().save(*args, **kwargs)
```

### 2. Spatial Queries
```python
# T√¨m b·ªánh vi·ªán trong b√°n k√≠nh X km
from django.contrib.gis.db.models.functions import Distance

hospitals = Hospital.objects.annotate(
    distance=Distance('location', user_point)
).filter(
    distance__lte=radius_m
).order_by('distance')

# T·∫°o buffer zone
from django.contrib.gis.measure import D

buffer_area = user_location.buffer(1)  # 1km buffer

# T√¨m b·ªánh vi·ªán trong v√πng buffer
hospitals_in_area = Hospital.objects.filter(location__within=buffer_area)
```

## üóÇÔ∏è File c·∫•u h√¨nh quan tr·ªçng

### 1. Backend Settings (`backend/settings.py`)
- C·∫•u h√¨nh PostGIS database
- GDAL/GEOS library paths
- CORS headers
- REST Framework settings

### 2. Frontend Environment (`.env`)
```
REACT_APP_API_URL=http://127.0.0.1:8000/api
REACT_APP_MAP_CENTER_LAT=10.762622
REACT_APP_MAP_CENTER_LNG=106.660172
REACT_APP_DEFAULT_RADIUS=5
```

## üöÄ Ch·∫°y d·ª± √°n

### 1. Backend
```bash
cd hospital_locator/backend
python manage.py runserver 8000
```

### 2. Frontend
```bash
cd hospital_locator/frontend
npm start  # ho·∫∑c npm run dev
```

### 3. Truy c·∫≠p
- **Frontend**: http://localhost:3000
- **Backend API**: http://localhost:8000/api/
- **Admin**: http://localhost:8000/admin/

## üìã Ghi ch√∫ quan tr·ªçng

1. **GDAL Requirement**: GeoDjango y√™u c·∫ßu GDAL library. Tr√™n Windows, c√†i ƒë·∫∑t t·ª´ OSGeo4W.
2. **PostGIS**: ƒê·ªÉ s·ª≠ d·ª•ng ƒë·∫ßy ƒë·ªß spatial features, c·∫ßn PostgreSQL v·ªõi PostGIS extension.
3. **CORS**: ƒê√£ c·∫•u h√¨nh CORS headers ƒë·ªÉ frontend c√≥ th·ªÉ giao ti·∫øp v·ªõi backend.
4. **Coordinate System**: S·ª≠ d·ª•ng WGS84 (EPSG:4326) - chu·∫©n GPS.
5. **Leaflet CRS**: S·ª≠ d·ª•ng L.CRS.EPSG4326 cho b·∫£n ƒë·ªì v·ªõi t·ªça ƒë·ªô ƒë·ªãa l√Ω th·ª±c.

